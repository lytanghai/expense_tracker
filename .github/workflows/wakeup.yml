name: Wake Up Render App

on:
  schedule:
    # Wakeup Render app from 8:00 to 23:00 UTC
    - cron: "0 8 * * *"             # Exactly 08:00
    - cron: "10-59/10 8 * * *"      # Every 10 min after 8:00 (until 8:50)
    - cron: "*/10 9-21 * * *"       # Every 10 min from 9:00 to 21:50
    - cron: "0-50/10 22 * * *"      # Every 10 min from 22:00 to 22:50

    # Daily at 10 PM UTC
    - cron: "0 22 * * *"

    # Monthly at 10 PM UTC on the last day of the month
    - cron: "0 22 28-31 * *"

    # Quarterly at 11:50 PM UTC (last day of March, June, September, December)
    - cron: "50 23 31 3,6,9,12 *"
  workflow_dispatch:  # Enables manual trigger

jobs:
  wakeup:
    if: github.event.schedule != null && startsWith(github.event.schedule, '*/10') || github.event.schedule == '0 8 * * *' || github.event.schedule == '10-59/10 8 * * *' || github.event.schedule == '*/10 9-21 * * *' || github.event.schedule == '0-50/10 22 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render app by calling API
        run: |
          curl --fail -X GET https://expense-tracker-istq.onrender.com/expense_tracker/expense/wakeup

  daily_trigger:
    if: github.event.schedule == '0 22 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Call daily 10 PM trigger
        run: |
          curl --fail -X GET https://expense-tracker-istq.onrender.com/expense_tracker/report/trigger/trigger-daily

  monthly_trigger:
    if: github.event.schedule == '0 22 28-31 * *'
    runs-on: ubuntu-latest
    steps:
      - name: Call last day of month 10 PM trigger (conditional check inside)
        run: |
          # Call only if today is the last day of the month
          if [ $(date -d tomorrow +%d) -eq 01 ]; then
            curl --fail -X GET https://expense-tracker-istq.onrender.com/expense_tracker/trigger/trigger-monthly
          else
            echo "Not the last day of the month, skipping monthly trigger."
          fi

  quarterly_trigger:
    if: github.event.schedule == '50 23 31 3,6,9,12 *'
    runs-on: ubuntu-latest
    steps:
      - name: Call quarterly 11:50 PM trigger
        run: |
          curl --fail -X GET https://expense-tracker-istq.onrender.com/expense_tracker/report/trigger-cleanup
