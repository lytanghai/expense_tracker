CREATE SEQUENCE saving_plan_id_seq START 1 INCREMENT 1;
CREATE SEQUENCE deposit_history_id_seq START 1 INCREMENT 1;

CREATE TABLE saving_plan (
  id integer NOT NULL DEFAULT nextval('saving_plan_id_seq'::regclass),
  plan_name VARCHAR(100) NOT NULL,
  target_amount NUMERIC(10, 2) NOT NULL,
  target_amount_currency VARCHAR(3) NOT NULL,
  current_amount NUMERIC(10, 2) DEFAULT 0,
  current_amount_currency VARCHAR(3) NOT NULL,
  deadline DATE,
  created_at TIMESTAMP DEFAULT NOW(),
  status VARCHAR(20) DEFAULT 'ongoing',
  CONSTRAINT saving_plan_pkey PRIMARY KEY (id),
  CONSTRAINT status_check CHECK (status IN ('ongoing', 'completed', 'cancelled'))
);

CREATE TABLE deposit_history (
  id integer NOT NULL DEFAULT nextval('deposit_history_id_seq'::regclass),
  plan_id INTEGER NOT NULL REFERENCES saving_plan(id) ON DELETE CASCADE,
  amount NUMERIC(10,2) NOT NULL,
  currency VARCHAR(3) NOT NULL,
  deposited_date TIMESTAMP NOT NULL,
  CONSTRAINT deposit_history_pkey PRIMARY KEY (id)
);

CREATE INDEX idx_deposit_history_plan_id ON deposit_history (plan_id);
